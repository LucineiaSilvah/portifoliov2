"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var UploadProgress=function(){function e(t){_classCallCheck(this,e),this._language=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage,this._formatter=new Intl.NumberFormat(this._language,{maximumFractionDigits:2}),this.progressMessage=t}return _createClass(e,[{key:"hackeditor",value:function(t){this._editor=t.core,this._imageProgressStatusBar=$(this._editor.gui.statusbar).children(".upload-image");t=$(this._editor.gui.toolbar);return t.append('<div class="img-upload-progress-wrapper"><div class="img-upload-progress"><span style="width: 0%"></span></div></div>'),this._progressBar=t.find(".img-upload-progress"),this.reset(),this}},{key:"markedEditor",value:function(t){return this._imageProgressStatusBar=t.find(".status-bar-img-upload"),this.reset(),this}},{key:"avatarUpload",value:function(){return this._progressBar=$(".img-upload-progress"),this._imageProgressStatusBar=this._progressBar.find(".img-upload-progress-text"),this.reset(),this}},{key:"reset",value:function(){this.progress=0,this.total=0,this.finished=0,this.files={},this._progressBar&&this._progressBar.find("span").css("width","0%"),this._imageProgressStatusBar&&this._imageProgressStatusBar.text("")}},{key:"addProgress",value:function(t,e){this.files["".concat(t)]=Math.min(e,100),this.recalculate(),this.changeTextProgress(e,t)}},{key:"changeTextProgress",value:function(t,e){var t=this._formatter.format(t),r=this._formatter.format(this.getProgress());this._imageProgressStatusBar&&(e=this.progressMessage.replace("#images_names#",e).replace("#progress#",t),this._imageProgressStatusBar.text("".concat(this.finished,"/").concat(this.total,"(").concat(r,"%): ").concat(e)))}},{key:"finish",value:function(t){this.files["".concat(t)]=100,this.finished=Math.min(this.finished+1,this.total),this.finished===this.total?this.hide():this.recalculate()}},{key:"recalculate",value:function(){this.progress=Object.values(this.files).reduce(function(t,e){return t+e}),this._progressBar&&this._progressBar.find("span").animate({width:"".concat(this.getProgress(),"%")},200)}},{key:"getProgress",value:function(){return this.progress/this.total}},{key:"build",value:function(t){var e=this;this.reset(),Array.from(t).forEach(function(t){return e.files["".concat(t.name)]=0}),this.total=t.length,this.recalculate(),this._progressBar&&this._progressBar.show()}},{key:"hide",value:function(){this._progressBar&&this._progressBar.hide()}}]),e}();